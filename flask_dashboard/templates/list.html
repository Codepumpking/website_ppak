<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œíŒ</title>
</head>
<body>
    <div class="container">
        
        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-top: 10px;">
            {% if current_user.is_authenticated %}
                <span style="font-weight: bold;">{{ current_user.name }}ë‹˜</span>
                <a href="{{ url_for('logout') }}" style="text-decoration: none; color: gray; font-size: 0.9em;">ë¡œê·¸ì•„ì›ƒ</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="btn" style="background-color: #28a745;">ë¡œê·¸ì¸</a>
                <a href="{{ url_for('register') }}" class="btn" style="background-color: #6c757d;">íšŒì›ê°€ì…</a>
            {% endif %}
        </div>
        <hr>

        {% if keyword %}
            <h1>'{{ keyword }}' ê²€ìƒ‰ ê²°ê³¼</h1>
            <a href="{{ url_for('post_list')}}" class="btn">ì „ì²´ ëª©ë¡ ë³´ê¸°</a>
        {% else %}
            <h1>ììœ  ê²Œì‹œíŒ</h1>
        {% endif %}

        <div class="search-box" style="margin:20px 0;">
            <form action="{{ url_for('search')}}" method="GET" style="display:flex; gap:10px; align-items:center"> 
                <select name="search_type" style="height: 40px; padding:0 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="title" {% if search_type =='title' %}selected{% endif %}>ì œëª©</option>
                    <option value="content" {% if search_type == 'content' %}selected{% endif %}>ë‚´ìš©</option>
                    <option value="both" {% if search_type == 'both' %}selected{% endif %}>ì œëª©+ë‚´ìš©</option>
                </select>
                <input type="text" name="keyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥..." value="{{ keyword }}" style="flex: 1; height: 40px; padding: 0 20px; border: 1px solid #ddd; border-radius: 4px;">
                <button type="submit" style="height: 40px; padding: 0 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">ê²€ìƒ‰</button>
            </form>
        </div>

        <a href="/write" class="btn">ê¸€ì“°ê¸°</a>
        <hr>
        
        {% for post in posts %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                
                <div style="display: flex; align-items: baseline; gap: 10px;">
                    <h3>
                        {% if post.is_secret == 1 and (not current_user.is_authenticated or post.writer_id != current_user.id) %}
                            <a href="{{ url_for('check_password_view', post_id=post.id) }}" style="color: #555;">
                                [ë¹„ë°€ê¸€] {{ post.title }}
                            </a>
                        
                        {% else %}
                            <a href="{{ url_for('post_detail', post_id=post.id) }}">
                                {% if post.is_secret == 1 %} {% endif %} {{ post.title }}
                            </a>
                        {% endif %}
                    </h3>
                    
                    <small style="color: #777; font-size: 0.9em;">by {{ post.writer_id }}</small>
                </div>

                {% if current_user.is_authenticated and post.writer_id == current_user.id %}
                <div style="display: flex; gap: 5px;">
                    <a href="{{ url_for('post_edit', id=post.id) }}" class="btn-edit">ìˆ˜ì •</a>
                    <form action="{{ url_for('post_delete', id=post.id) }}" method="POST" style="margin: 0;">
                        <button type="submit" class="btn-cancel" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                    </form>
                </div>
                {% endif %}
            </div>

            {% if post.is_secret == 1 and (not current_user.is_authenticated or post.writer_id != current_user.id) %}
                <p style="color: #aaa; font-style: italic;">ë¹„ë°€ê¸€ì…ë‹ˆë‹¤.</p>
            {% else %}
                <p>{{ post.content }}</p>
                {% if post.file_path %}
                    <br><small>ğŸ“ ì²¨ë¶€íŒŒì¼ ìˆìŒ</small>
                {% endif %}
            {% endif %}

            <small style="color: #999;">ì‘ì„±ì¼: {{ post.created_at }}</small>
            <hr>
        </div>
        {% endfor %}

        {% if not posts %}
            <p>ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>
</body>
</html>